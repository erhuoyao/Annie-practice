<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>评分生成器</title>
    <style>
        /* 原样式代码略 */
    </style>
</head>
<body>
    <div class="container">
        <h1 id="welcomeMessage" style="font-size: 18px;">评分生成器</h1>
        <h3 style="font-size: 16px;">温馨提示</h3>
        <p style="font-size: 12px;">作答到一半或开始作答任务的时候，如果有事离开，或者您感到劳累需要休息，可以进行短暂的休息或者离开，但是请勿关闭当前作答窗口，否则退出后之前的作答内容不会被保留。</p>
        <div class="progress-bar">
            <div class="progress-bar-inner" id="progressBar">0%</div>
        </div>
        <img id="image" src="" alt="示例图片">
        <a id="downloadLink" href="" download="image.jpg" style="display: block; margin: 10px;">下载图片</a>
        <div class="section">
            <form id="questionForm">
                <!-- 原表单代码略 -->
                <button type="submit">提交答案</button>
            </form>
        </div>
        <button id="endButton" class="hidden">结束</button>
    </div>

    <script>
        let imagePaths = [];
        let currentImageIndex = 0;
        const totalImages = 150; // 总图片数
        let userResponses = [];

        document.addEventListener('DOMContentLoaded', () => {
            fetch('image_split_1.json')
                .then(response => response.json())
                .then(data => {
                    imagePaths = data;
                    displayImage();
                    updateProgressBar();
                });

            document.getElementById('questionForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('endButton').addEventListener('click', showResults);
        });

        function handleFormSubmit(event) {
            event.preventDefault();

            const response = {
                image: imagePaths[currentImageIndex],
                question1: document.querySelector('input[name="question1"]:checked').value,
                question2: document.querySelector('input[name="question2"]:checked').value,
                question3: document.querySelector('input[name="question3"]:checked').value,
                question4: document.querySelector('input[name="question4"]:checked').value
            };

            userResponses.push(response);

            currentImageIndex++;
            if (currentImageIndex < imagePaths.length) {
                displayImage();
                resetForm();
                updateProgressBar();
            } else {
                document.getElementById('questionForm').classList.add('hidden');
                document.getElementById('endButton').classList.remove('hidden');
                updateProgressBar();
            }
        }

        function resetForm() {
            document.querySelectorAll('input[type="radio"]').forEach(input => input.checked = false);
        }

        function displayImage() {
            if (currentImageIndex < imagePaths.length) {
                const imgElement = document.getElementById('image');
                const downloadLink = document.getElementById('downloadLink');
                const currentImagePath = imagePaths[currentImageIndex];

                imgElement.src = currentImagePath;
                downloadLink.href = currentImagePath; // 设置下载链接
                downloadLink.download = `image_${currentImageIndex + 1}.jpg`; // 设置默认文件名
            }
        }

        function updateProgressBar() {
            const progress = Math.min((currentImageIndex / totalImages) * 100, 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${currentImageIndex}/${totalImages}`;
        }

        function showResults() {
            localStorage.setItem('userResponses', JSON.stringify(userResponses));
            alert('数据已收集完成！即将跳转到结果页面。');
            window.location.href = 'task_end.html';
        }
    </script>
</body>
</html>
